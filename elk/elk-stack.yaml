namespace: elk


elasticsearch:
  defines: runnable
  containers:
    defines: containers
    elasticsearch:
      image: docker.elastic.co/elasticsearch/elasticsearch
      image-tag: <- `${elasticsearch-image}`
      user: "elasticsearch"
      ports:
      - <- `${internal-port}:${internal-port}`
      - <- `${port}:${port}`
      environment:
      - <- `ES_JAVA_OPTS=${jvm-opts}`
      - discovery.type=single-node
      paths:
        - <- `${monk-volume-path}/elasticsearch/data:/usr/share/elasticsearch/data`      
  files:
    elasticsearch-config:
      container: elasticsearch
      mode: 0644
      path: /usr/share/elasticsearch/config/elasticsearch.yml
      contents: <<< files/elasticsearch.yml
  variables:
    defines: variables
    elasticsearch-image:
      value: <- $elasticsearch-image-tag
      type: string
    jvm-opts:
      value: <- $jvm-options
      type: string
    port:
      value: <- $elasticsearch-http-port
      type: int
    internal-port:
      value: <- $elasticsearch-internal-port
      type: int


# kibana:
#   defines: runnable
#   variables:
#     defines: variables
#     elasticsearch-hosts:
#       type: string
#       value: get-hostname("/elk/elasticsearch", "elasticsearch")
#     port:
#       type: int
#       value: 5601
#   containers:
#     defines: containers
#     kibana:
#       ports:
#       - <- `${port}:${port}`
#       image-tag: 7.9.0
#       environment:
#       - <- `ELASTICSEARCH_HOSTS=http://${elasticsearch-hosts}:9200`
#       image: docker.elastic.co/kibana/kibana      


# logstash:
#   defines: runnable
#   variables:
#     defines: variables
#     elasticsearch-host:
#       type: string
#       value: elasticsearch
#     elasticsearch-port:
#       value: "9200"
#       type: string
#     jvm-options:
#       type: string
#       value: -Xmx256m -Xms256m
#     port:
#       value: 9600
#       type: int
#     elasticsearch-hosts:
#       type: string
#       value: get-hostname("/elk/elasticsearch-1", "elasticsearch")
#   containers:
#     defines: containers
#     logstash:
#       environment:
#       - <- `LS_JAVA_OPTS=${jvm-options}`
#       - http.host=0.0.0.0
#       - xpack.monitoring.enabled=false
#       - <- `monitoring.elasticsearch.hosts=http://${elasticsearch-host}:${elasticsearch-port}`
#       image-tag: 7.9.0
#       image: docker.elastic.co/logstash/logstash
#       ports:
#       - 5044:5044/tcp
#       - 5044:5044/udp
#       - <- `${port}:${port}`      